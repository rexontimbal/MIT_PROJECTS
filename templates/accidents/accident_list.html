{% extends 'base.html' %}
{% load static %}

{% block title %}Accident List - AGNES Hotspot System{% endblock %}

{% block breadcrumb_items %}
<span> / Accidents</span>
{% endblock %}

{% block extra_css %}
<style>
    :root {
        --fatal-red: #DC143C;
        --injury-orange: #FFA500;
        --property-blue: #6C757D;
        --hotspot-red: #DC143C;
        --primary-blue: #003087;
        --success-green: #28A745;
    }

    .accident-list-container {
        max-width: 1400px;
        margin: 0 auto;
    }

    /* Hero Header */
    .page-hero {
        background: linear-gradient(135deg, #003087 0%, #0052CC 100%);
        color: white;
        padding: 35px;
        border-radius: 15px;
        margin-bottom: 25px;
        box-shadow: 0 4px 12px rgba(0, 48, 135, 0.2);
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 20px;
    }

    .page-hero-content {
        flex: 1;
        min-width: 300px;
    }

    .page-hero h1 {
        font-size: 2.2rem;
        margin-bottom: 10px;
        display: flex;
        align-items: center;
        gap: 15px;
        flex-wrap: wrap;
    }

    .page-hero p {
        font-size: 1.1rem;
        opacity: 0.95;
        margin: 0;
    }

    .hero-badge {
        background: rgba(255, 255, 255, 0.2);
        padding: 5px 15px;
        border-radius: 20px;
        font-size: 0.9rem;
    }

    .hero-actions {
        display: flex;
        gap: 12px;
        flex-wrap: wrap;
    }

    .hero-actions .btn {
        padding: 12px 24px;
        font-size: 0.95rem;
        font-weight: 600;
        border-radius: 8px;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 8px;
        border: none;
        cursor: pointer;
    }

    .hero-actions .btn-outline-light {
        background: transparent;
        color: white;
        border: 2px solid rgba(255, 255, 255, 0.8);
    }

    .hero-actions .btn-outline-light:hover {
        background: rgba(255, 255, 255, 0.1);
        border-color: white;
        transform: translateY(-2px);
    }

    /* Unified Filters Section - Modern Design */
    .filters-section {
        background: white;
        padding: 1.75rem;
        border-radius: 8px;
        box-shadow: 0 1px 3px rgba(0,0,0,0.06);
        margin-bottom: 1.5rem;
        border: 1px solid #E5E7EB;
    }

    .filters-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.25rem;
    }

    .filters-header h3 {
        margin: 0;
        font-size: 1.125rem;
        font-weight: 600;
        color: #111827;
    }

    /* Search Input - Modern & Flat */
    .search-wrapper {
        position: relative;
        display: flex;
        gap: 0.75rem;
    }

    .search-input-wrapper {
        position: relative;
        flex: 1;
    }

    #searchInput {
        width: 100%;
        padding: 0.75rem 1rem 0.75rem 2.75rem;
        border: 1.5px solid #D1D5DB;
        border-radius: 6px;
        font-size: 0.9375rem;
        transition: all 0.2s ease;
        background: white;
    }

    #searchInput:hover {
        border-color: #9CA3AF;
    }

    #searchInput:focus {
        outline: none;
        border-color: var(--primary-blue);
        box-shadow: 0 0 0 3px rgba(0, 48, 135, 0.08);
    }

    .search-icon {
        position: absolute;
        left: 1rem;
        top: 50%;
        transform: translateY(-50%);
        color: #6B7280;
        pointer-events: none;
    }

    .search-button {
        padding: 0.75rem 1.5rem;
        background: var(--primary-blue);
        color: white;
        border: none;
        border-radius: 6px;
        font-weight: 500;
        font-size: 0.875rem;
        cursor: pointer;
        transition: all 0.2s ease;
        white-space: nowrap;
    }

    .search-button:hover {
        background: #0052CC;
        transform: translateY(-1px);
    }

    /* Search Input - Modern & Flat */
    #hotspotSearch {
        width: 100%;
        padding: 0.75rem 1rem 0.75rem 2.75rem;
        border: 1.5px solid #D1D5DB;
        border-radius: 6px;
        font-size: 0.9375rem;
        transition: all 0.2s ease;
        background: white;
    }

    #hotspotSearch:hover {
        border-color: #9CA3AF;
    }

    #hotspotSearch:focus {
        outline: none;
        border-color: var(--primary-blue);
        box-shadow: 0 0 0 3px rgba(0, 48, 135, 0.08);
    }

    .search-icon {
        position: absolute;
        left: 1rem;
        top: 50%;
        transform: translateY(-50%);
        color: #6B7280;
        pointer-events: none;
    }

    /* Quick Search Buttons */
    .quick-search-btn {
        padding: 0.4rem 0.875rem;
        font-size: 0.8125rem;
        font-weight: 600;
        color: white;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.2s ease;
        display: inline-flex;
        align-items: center;
        gap: 0.375rem;
        text-transform: uppercase;
        letter-spacing: 0.3px;
    }

    .quick-search-btn.fatal {
        background: var(--fatal-red);
    }

    .quick-search-btn.injury {
        background: var(--injury-orange);
    }

    .quick-search-btn.property {
        background: var(--property-blue);
    }

    .quick-search-btn.standalone {
        background: #10B981;
    }

    .quick-search-btn:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        filter: brightness(1.1);
    }

    .quick-search-btn:active {
        transform: translateY(0);
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.15);
    }

    .quick-search-btn i {
        font-size: 0.75rem;
    }

    /* Filter Grid - Clean Layout */
    .filters-grid {
        display: grid;
        grid-template-columns: repeat(5, 1fr);
        gap: 0.875rem;
        margin-top: 1.25rem;
    }

    @media (max-width: 1200px) {
        .filters-grid {
            grid-template-columns: repeat(3, 1fr);
        }
    }

    @media (max-width: 768px) {
        .filters-grid {
            grid-template-columns: repeat(2, 1fr);
        }
    }

    @media (max-width: 480px) {
        .filters-grid {
            grid-template-columns: 1fr;
        }
    }

    .filter-group {
        display: flex;
        flex-direction: column;
        gap: 0.4rem;
    }

    .filter-group label {
        font-weight: 500;
        color: #374151;
        font-size: 0.875rem;
    }

    .filter-group select,
    .filter-group input[type="date"] {
        padding: 0.625rem 0.875rem;
        border: 1.5px solid #D1D5DB;
        border-radius: 6px;
        font-size: 0.875rem;
        transition: all 0.2s ease;
        background: white;
        cursor: pointer;
    }

    .filter-group select:hover,
    .filter-group input[type="date"]:hover {
        border-color: #9CA3AF;
    }

    .filter-group select:focus,
    .filter-group input[type="date"]:focus {
        outline: none;
        border-color: var(--primary-blue);
        box-shadow: 0 0 0 3px rgba(0, 48, 135, 0.08);
    }

    /* Quick Filters as Pills */
    .quick-filters {
        display: flex;
        gap: 0.5rem;
        flex-wrap: wrap;
        margin-top: 1rem;
        padding-top: 1rem;
        border-top: 1px solid #E5E7EB;
    }

    .quick-filter-btn {
        padding: 0.5rem 1rem;
        border: 1.5px solid #D1D5DB;
        background: white;
        border-radius: 6px;
        font-weight: 500;
        font-size: 0.875rem;
        cursor: pointer;
        transition: all 0.2s ease;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        color: #374151;
    }

    .quick-filter-btn:hover {
        border-color: var(--primary-blue);
        background: #F9FAFB;
    }

    .quick-filter-btn.active {
        background: var(--primary-blue);
        color: white;
        border-color: var(--primary-blue);
    }

    .quick-filter-btn.fatal.active {
        background: var(--fatal-red);
        border-color: var(--fatal-red);
    }

    .quick-filter-btn.injury.active {
        background: var(--injury-orange);
        border-color: var(--injury-orange);
    }

    .quick-filter-btn.hotspot.active {
        background: var(--hotspot-red);
        border-color: var(--hotspot-red);
    }

    .quick-filter-btn.standalone.active {
        background: linear-gradient(135deg, #6C757D, #495057);
        border-color: #6C757D;
    }

    /* Active Filters Tags - Blue Theme */
    .active-filters {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        margin-top: 1rem;
        padding-top: 1rem;
        border-top: 1px solid #E5E7EB;
    }

    .active-filters.hidden {
        display: none;
    }

    .filter-tag {
        background: #E8F0FE;
        color: #003087;
        padding: 0.375rem 0.75rem;
        border-radius: 6px;
        font-size: 0.8125rem;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        font-weight: 500;
        border: 1px solid #BBDEFB;
    }

    .filter-tag button {
        background: none;
        border: none;
        color: var(--primary-blue);
        cursor: pointer;
        font-weight: 600;
        font-size: 1.125rem;
        line-height: 1;
        padding: 0;
        margin-left: 0.25rem;
        transition: all 0.2s;
    }

    .filter-tag button:hover {
        color: #0052CC;
    }

    /* Active Filters Tags - Blue Theme */
    .active-filters {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        margin-top: 1rem;
        padding-top: 1rem;
        border-top: 1px solid #E5E7EB;
    }

    .active-filters.hidden {
        display: none;
    }

    .filter-tag {
        background: #E8F0FE;
        color: #003087;
        padding: 0.375rem 0.75rem;
        border-radius: 6px;
        font-size: 0.8125rem;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        font-weight: 500;
        border: 1px solid #BBDEFB;
    }

    .filter-tag button {
        background: none;
        border: none;
        color: var(--primary-blue);
        cursor: pointer;
        font-weight: 600;
        font-size: 1.125rem;
        line-height: 1;
        padding: 0;
        margin-left: 0.25rem;
        transition: all 0.2s;
    }

    .filter-tag button:hover {
        color: #0052CC;
    }

    /* Summary Cards - Flat & Clean */
    .summary-cards {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
        margin-bottom: 1.5rem;
    }

    .summary-card {
        background: white;
        padding: 1.5rem;
        border-radius: 8px;
        box-shadow: 0 1px 3px rgba(0,0,0,0.06);
        text-align: center;
        transition: all 0.2s ease;
        border: 1px solid #E5E7EB;
    }

    .summary-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }

    .summary-card h3 {
        font-size: 2rem;
        color: var(--primary-blue);
        margin-bottom: 0.5rem;
        font-weight: 700;
    }

    .summary-card p {
        color: #6B7280;
        font-size: 0.875rem;
        margin: 0;
    }

    /* Modern Button Styles */
    .btn {
        padding: 0.625rem 1.25rem;
        border-radius: 6px;
        font-size: 0.875rem;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s ease;
        border: none;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
    }

    .btn-primary {
        background: var(--primary-blue);
        color: white;
        border: 1px solid var(--primary-blue);
    }

    .btn-primary:hover {
        background: #0052CC;
        border-color: #0052CC;
        transform: translateY(-1px);
    }

    .btn-outline {
        background: white;
        color: #6B7280;
        border: 1.5px solid #D1D5DB;
    }

    .btn-outline:hover {
        background: var(--primary-blue);
        border-color: var(--primary-blue);
        color: white;
    }

    .btn-sm {
        padding: 0.5rem 1rem;
        font-size: 0.8125rem;
    }

    /* View Toggle - Flat Design */
    .view-toggle {
        display: flex;
        background: #F3F4F6;
        border-radius: 6px;
        padding: 0.25rem;
        margin-bottom: 1rem;
        border: 1px solid #E5E7EB;
    }

    .view-option {
        flex: 1;
        padding: 0.5rem 1rem;
        text-align: center;
        cursor: pointer;
        border-radius: 4px;
        transition: all 0.2s ease;
        font-size: 0.875rem;
        font-weight: 500;
        color: #6B7280;
        border: 2px solid transparent;
        background: transparent;
    }

    .view-option:hover:not(.active) {
        border-color: #003087;
        color: #003087;
        background: rgba(0, 48, 135, 0.05);
    }

    .view-option.active {
        background: var(--primary-blue);
        color: white;
        box-shadow: 0 1px 3px rgba(0,0,0,0.08);
        border-color: var(--primary-blue);
    }

    /* Pagination - Modern Flat (matching hotspots exactly) */
    .pagination-container {
        background: white;
        padding: 1rem 1.5rem;
        border-radius: 8px;
        box-shadow: 0 1px 3px rgba(0,0,0,0.06);
        margin-bottom: 1rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 1rem;
        border: 1px solid #E5E7EB;
        position: relative;
    }

    .pagination-info {
        color: #6B7280;
        font-size: 0.875rem;
        flex: 1;
    }

    .pagination-controls {
        display: flex;
        gap: 0.5rem;
        align-items: center;
        position: absolute;
        left: 50%;
        transform: translateX(-50%);
    }

    .pagination-controls button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }

    #pageInfo {
        padding: 0 1rem;
        font-weight: 600;
        color: #111827;
        font-size: 0.875rem;
    }

    #itemsPerPage {
        padding: 0.5rem 0.75rem;
        border: 1.5px solid #D1D5DB;
        border-radius: 6px;
        font-size: 0.875rem;
        background: white;
        cursor: pointer;
    }

    /* Accidents Grid - Matching Hotspots */
    .accidents-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 1rem;
        margin-bottom: 2rem;
    }

    .accident-card {
        background: white;
        border-radius: 8px;
        border: 1px solid #E5E7EB;
        border-left: 3px solid #003087;
        overflow: hidden;
        transition: all 0.2s ease;
        position: relative;
    }

    .accident-card:hover {
        border-color: #D1D5DB;
        border-left-color: #003087;
        box-shadow: 0 1px 3px rgba(0,0,0,0.04);
    }

    .card-header {
        padding: 16px 20px;
        background: linear-gradient(135deg, #003087 0%, #0052CC 100%);
        border-bottom: 1px solid #F0F1F3;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .severity-badge {
        font-size: 0.75rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 4px 10px;
        border-radius: 4px;
        color: white;
    }

    .severity-badge.fatal {
        background: var(--fatal-red);
    }

    .severity-badge.injury {
        background: var(--injury-orange);
    }

    .severity-badge.property {
        background: var(--property-blue);
    }

    .hotspot-mini-badge {
        background: #FEF3C7;
        color: #92400E;
        padding: 4px 10px;
        border-radius: 4px;
        font-size: 0.7rem;
        font-weight: 600;
        letter-spacing: 0.3px;
        border: 1px solid #FDE68A;
    }

    .hotspot-mini-badge i {
        color: #D97706;
        font-size: 0.75rem;
    }

    .card-body {
        padding: 20px;
    }

    .card-date {
        display: flex;
        align-items: center;
        gap: 8px;
        color: #9CA3AF;
        font-size: 0.875rem;
        margin-bottom: 14px;
    }

    .card-date i {
        color: #D1D5DB;
        font-size: 0.8rem;
    }

    .card-date strong {
        color: #374151;
        font-weight: 500;
    }

    .card-location {
        margin-bottom: 14px;
    }

    .card-location-title {
        font-weight: 600;
        font-size: 1.05rem;
        color: #111827;
        margin-bottom: 4px;
    }

    .card-location-sub {
        color: #6B7280;
        font-size: 0.875rem;
        display: flex;
        align-items: center;
        gap: 5px;
    }

    .card-location-sub i {
        color: #9CA3AF;
        font-size: 0.75rem;
    }

    .card-type {
        background: transparent;
        padding: 0;
        border-radius: 0;
        font-size: 0.875rem;
        color: #6B7280;
        margin-bottom: 16px;
        line-height: 1.5;
    }

    .card-type i {
        color: #D1D5DB;
        margin-right: 6px;
        font-size: 0.75rem;
    }

    .card-actions {
        display: flex;
        gap: 8px;
        padding-top: 14px;
        border-top: 1px solid #F3F4F6;
    }

    .card-action-btn {
        flex: 1;
        padding: 9px 12px;
        border: 1px solid #E5E7EB;
        background: white;
        color: #374151;
        border-radius: 6px;
        font-weight: 500;
        font-size: 0.875rem;
        cursor: pointer;
        transition: all 0.15s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 6px;
    }

    .card-action-btn i {
        font-size: 0.8rem;
        color: #6B7280;
    }

    .card-action-btn:hover {
        background: #F9FAFB;
        border-color: #D1D5DB;
    }

    /* Card View Button - View */
    .card-action-btn.btn-view {
        background: #E3F2FD;
        color: var(--primary-blue);
        border-color: #BBDEFB;
    }

    .card-action-btn.btn-view i {
        color: var(--primary-blue);
    }

    .card-action-btn.btn-view:hover {
        background: var(--primary-blue);
        color: white;
        border-color: var(--primary-blue);
    }

    .card-action-btn.btn-view:hover i {
        color: white;
    }

    /* Card View Button - Map */
    .card-action-btn.btn-map {
        background: #E8F5E9;
        color: var(--success-green);
        border-color: #C8E6C9;
    }

    .card-action-btn.btn-map i {
        color: var(--success-green);
    }

    .card-action-btn.btn-map:hover {
        background: var(--success-green);
        color: white;
        border-color: var(--success-green);
    }

    .card-action-btn.btn-map:hover i {
        color: white;
    }

    /* Table View */
    .accidents-table-container {
        background: white;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        overflow: hidden;
        margin-bottom: 30px;
    }

    .table-responsive {
        overflow-x: auto;
    }

    .table-responsive.scrollable {
        max-height: 700px;
    }

    .accidents-table {
        width: 100%;
        border-collapse: collapse;
    }

    .accidents-table thead {
        background: #F8F9FA;
        position: sticky;
        top: 0;
        z-index: 10;
    }

    .accidents-table th {
        padding: 15px 12px;
        text-align: left;
        font-weight: 700;
        color: #333;
        border-bottom: 2px solid #DEE2E6;
        font-size: 0.9rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .accidents-table td {
        padding: 15px 12px;
        border-bottom: 1px solid #F1F3F5;
        vertical-align: middle;
    }

    .accidents-table tbody tr {
        transition: all 0.2s;
        cursor: pointer;
    }

    .accidents-table tbody tr:hover {
        background: #F8F9FA;
    }

    .severity-dot {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        display: inline-block;
        margin-right: 8px;
    }

    .severity-dot.fatal {
        background: var(--fatal-red);
        box-shadow: 0 0 0 3px rgba(220, 20, 60, 0.2);
    }

    .severity-dot.injury {
        background: var(--injury-orange);
        box-shadow: 0 0 0 3px rgba(255, 165, 0, 0.2);
    }

    .severity-dot.property {
        background: var(--property-blue);
        box-shadow: 0 0 0 3px rgba(108, 117, 125, 0.2);
    }

    .table-actions {
        display: flex;
        gap: 5px;
    }

    .table-action-btn {
        padding: 6px 12px;
        border: none;
        border-radius: 6px;
        font-size: 0.85rem;
        cursor: pointer;
        transition: all 0.2s;
        font-weight: 600;
    }

    .table-action-btn.view {
        background: #E3F2FD;
        color: var(--primary-blue);
    }

    .table-action-btn.view:hover {
        background: var(--primary-blue);
        color: white;
    }

    .table-action-btn.map {
        background: #E8F5E9;
        color: var(--success-green);
    }

    .table-action-btn.map:hover {
        background: var(--success-green);
        color: white;
    }

    .text-center {
        text-align: center;
    }

    /* Empty State */
    .empty-state {
        text-align: center;
        padding: 60px 20px;
        color: #6C757D;
    }

    .empty-state i {
        font-size: 4rem;
        margin-bottom: 20px;
        opacity: 0.3;
    }

    .empty-state h3 {
        margin-bottom: 10px;
        color: #495057;
    }

    /* Pagination */
    .pagination-container {
        display: flex;
        justify-content: center;
        margin-top: 30px;
    }

    .pagination {
        display: flex;
        gap: 5px;
        list-style: none;
        padding: 0;
    }

    .page-item {
        margin: 0;
    }

    .page-link {
        padding: 10px 16px;
        border: 2px solid #E9ECEF;
        background: white;
        color: var(--primary-blue);
        text-decoration: none;
        border-radius: 8px;
        font-weight: 600;
        transition: all 0.3s;
        display: flex;
        align-items: center;
        gap: 5px;
    }

    .page-link:hover {
        background: #F8F9FA;
        border-color: var(--primary-blue);
        transform: translateY(-2px);
    }

    .page-item.active .page-link {
        background: var(--primary-blue);
        color: white;
        border-color: var(--primary-blue);
    }

    .page-item.disabled .page-link {
        color: #ADB5BD;
        background: #F8F9FA;
        cursor: not-allowed;
        transform: none;
    }

    /* Loading Animation */
    .loading-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(255, 255, 255, 0.9);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 9999;
        display: none;
    }

    .loading-overlay.active {
        display: flex;
    }

    .spinner {
        border: 4px solid #f3f3f3;
        border-top: 4px solid var(--primary-blue);
        border-radius: 50%;
        width: 50px;
        height: 50px;
        animation: spin 1s linear infinite;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    /* Accident Modal */
    .accident-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 9999;
        animation: fadeIn 0.3s ease;
    }

    .accident-modal.active {
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .modal-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        backdrop-filter: blur(4px);
    }

    .modal-content {
        position: relative;
        background: white;
        border-radius: 12px;
        width: 90%;
        max-width: 600px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        animation: slideUp 0.3s ease;
        overflow: hidden;
    }

    .modal-close {
        position: absolute;
        top: 1rem;
        right: 1rem;
        background: transparent;
        border: none;
        font-size: 1.5rem;
        color: #6B7280;
        cursor: pointer;
        z-index: 10;
        transition: color 0.2s;
    }

    .modal-close:hover {
        color: #DC143C;
    }

    .modal-header {
        background: linear-gradient(135deg, #003087 0%, #0052CC 100%);
        color: white;
        padding: 1.5rem 2rem;
    }

    .modal-header h2 {
        margin: 0;
        font-size: 1.5rem;
        margin-bottom: 0.75rem;
    }

    .modal-badges {
        display: flex;
        gap: 0.5rem;
        flex-wrap: wrap;
    }

    .modal-body {
        padding: 2rem;
    }

    .modal-info-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 1.5rem;
    }

    .modal-info-item {
        display: flex;
        gap: 1rem;
        align-items: flex-start;
    }

    .modal-info-item > i {
        color: #003087;
        font-size: 1.25rem;
        margin-top: 0.25rem;
    }

    .modal-label {
        font-size: 0.75rem;
        text-transform: uppercase;
        color: #6B7280;
        font-weight: 600;
        letter-spacing: 0.5px;
        margin-bottom: 0.25rem;
    }

    .modal-value {
        font-size: 0.95rem;
        color: #111827;
        font-weight: 500;
    }

    .modal-footer {
        padding: 1.5rem 2rem;
        background: #F9FAFB;
        border-top: 1px solid #E5E7EB;
        display: flex;
        gap: 1rem;
        justify-content: flex-end;
    }

    .modal-btn {
        padding: 0.75rem 1.5rem;
        border: none;
        border-radius: 8px;
        font-weight: 600;
        font-size: 0.9rem;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        transition: all 0.2s ease;
    }

    .modal-btn.btn-map {
        background: #10B981;
        color: white;
    }

    .modal-btn.btn-map:hover {
        background: #059669;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
    }

    .modal-btn.btn-detail {
        background: var(--primary-blue);
        color: white;
    }

    .modal-btn.btn-detail:hover {
        background: #002070;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 48, 135, 0.3);
    }

    @keyframes fadeIn {
        from {
            opacity: 0;
        }
        to {
            opacity: 1;
        }
    }

    @keyframes slideUp {
        from {
            opacity: 0;
            transform: translateY(30px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    /* Responsive */
    @media (max-width: 768px) {
        .page-hero h1 {
            font-size: 1.6rem;
        }

        .accidents-grid {
            grid-template-columns: 1fr;
        }

        .quick-filters {
            justify-content: center;
        }

        .view-controls {
            flex-direction: column;
            align-items: stretch;
        }

        .view-toggle {
            justify-content: center;
        }

        .search-box {
            flex-direction: column;
        }

        .stats-section {
            grid-template-columns: repeat(2, 1fr);
        }

        .modal-content {
            width: 95%;
            max-height: 90vh;
        }

        .modal-info-grid {
            grid-template-columns: 1fr;
            gap: 1rem;
        }

        .modal-body {
            padding: 1.5rem;
        }

        .modal-footer {
            flex-direction: column;
            gap: 0.75rem;
        }

        .modal-btn {
            width: 100%;
            justify-content: center;
        }

        .filters-content {
            grid-template-columns: 1fr;
        }
    }

    @media (max-width: 480px) {
        .stats-section {
            grid-template-columns: 1fr;
        }

        .card-actions {
            flex-direction: column;
        }
    }
</style>
{% endblock %}

{% block extra_js %}
<script>
// Municipality data
const municipalityData = {{ municipality_data_json|safe }};

// No client-side pagination state needed - server handles everything

// View toggle
function switchView(viewType) {
    const cardsView = document.getElementById('cardsView');
    const tableView = document.getElementById('tableView');
    const options = document.querySelectorAll('.view-option');

    options.forEach(opt => opt.classList.remove('active'));
    event.target.classList.add('active');

    if (viewType === 'cards') {
        cardsView.style.display = 'block';
        tableView.style.display = 'none';
    } else {
        cardsView.style.display = 'none';
        tableView.style.display = 'block';
    }
}

// ===== SMOOTH PAGE UPDATES WITHOUT RELOAD =====

function showLoading() {
    document.querySelector('.loading-overlay').classList.add('active');
}

function hideLoading() {
    document.querySelector('.loading-overlay').classList.remove('active');
}

function updatePageContent(url, pushState = true) {
    showLoading();

    fetch(url)
        .then(response => response.text())
        .then(html => {
            const parser = new DOMParser();
            const doc = parser.parseFromString(html, 'text/html');

            // Update accidents container (both cards and table view)
            const newCardsView = doc.getElementById('cardsView');
            const newTableView = doc.getElementById('tableView');
            const currentCardsView = document.getElementById('cardsView');
            const currentTableView = document.getElementById('tableView');

            if (newCardsView && currentCardsView) {
                currentCardsView.innerHTML = newCardsView.innerHTML;
            }
            if (newTableView && currentTableView) {
                currentTableView.innerHTML = newTableView.innerHTML;
            }

            // Update pagination
            const newPagination = doc.querySelector('.pagination-container');
            const currentPagination = document.querySelector('.pagination-container');
            if (newPagination && currentPagination) {
                currentPagination.innerHTML = newPagination.innerHTML;
            }

            // Update summary cards
            const newSummaryCards = doc.querySelector('.summary-cards');
            const currentSummaryCards = document.querySelector('.summary-cards');
            if (newSummaryCards && currentSummaryCards) {
                currentSummaryCards.innerHTML = newSummaryCards.innerHTML;
            }

            // Update filter dropdowns to match URL parameters
            const urlParams = new URLSearchParams(new URL(url).search);
            const perPageParam = urlParams.get('per_page') || '100';
            const provinceParam = urlParams.get('province') || '';
            const municipalParam = urlParams.get('municipal') || '';
            const yearParam = urlParams.get('year') || '';
            const searchParam = urlParams.get('search') || '';

            document.getElementById('itemsPerPage').value = perPageParam;
            document.getElementById('province').value = provinceParam;

            // Update municipalities based on selected province
            updateMunicipalityDropdown();

            // Then set the municipal value after updating the dropdown
            document.getElementById('municipal').value = municipalParam;
            document.getElementById('year').value = yearParam;
            document.getElementById('hotspotSearch').value = searchParam;

            // Update browser URL without reload FIRST
            if (pushState) {
                history.pushState({}, '', url);
            }

            // Update active filters badges AFTER URL is updated
            updateActiveFilters();

            // Scroll to search section
            const searchSection = document.getElementById('search-section');
            if (searchSection) {
                searchSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }

            hideLoading();
        })
        .catch(error => {
            console.error('Error loading content:', error);
            // Fallback to normal page load if fetch fails
            window.location.href = url;
        });
}

// Quick search function for category buttons
function quickSearch(keyword) {
    document.getElementById('hotspotSearch').value = keyword;
    performSearch();
}

// Search function - Smooth update without reload
function performSearch() {
    const searchValue = document.getElementById('hotspotSearch').value.trim();
    const currentUrl = new URL(window.location.href);

    if (searchValue) {
        currentUrl.searchParams.set('search', searchValue);
    } else {
        currentUrl.searchParams.delete('search');
    }

    // Keep existing filters
    const province = document.getElementById('province').value;
    const municipal = document.getElementById('municipal').value;
    const year = document.getElementById('year').value;

    if (province) currentUrl.searchParams.set('province', province);
    if (municipal) currentUrl.searchParams.set('municipal', municipal);
    if (year) currentUrl.searchParams.set('year', year);

    // Reset to first page
    currentUrl.searchParams.delete('page');

    // Smooth update instead of reload
    updatePageContent(currentUrl.toString());
}

function applyServerSideFilters() {
    const currentUrl = new URL(window.location.href);

    // Get filter values
    const searchValue = document.getElementById('hotspotSearch').value.trim();
    const province = document.getElementById('province').value;
    const municipal = document.getElementById('municipal').value;
    const year = document.getElementById('year').value;
    const dateFrom = document.getElementById('date_from').value;
    const dateTo = document.getElementById('date_to').value;

    // Update URL parameters
    if (searchValue) {
        currentUrl.searchParams.set('search', searchValue);
    } else {
        currentUrl.searchParams.delete('search');
    }

    if (province) {
        currentUrl.searchParams.set('province', province);
    } else {
        currentUrl.searchParams.delete('province');
    }

    if (municipal) {
        currentUrl.searchParams.set('municipal', municipal);
    } else {
        currentUrl.searchParams.delete('municipal');
    }

    if (year) {
        currentUrl.searchParams.set('year', year);
    } else {
        currentUrl.searchParams.delete('year');
    }

    if (dateFrom) {
        currentUrl.searchParams.set('date_from', dateFrom);
    } else {
        currentUrl.searchParams.delete('date_from');
    }

    if (dateTo) {
        currentUrl.searchParams.set('date_to', dateTo);
    } else {
        currentUrl.searchParams.delete('date_to');
    }

    // Reset to first page when filters change
    currentUrl.searchParams.delete('page');

    // Smooth update instead of reload
    updatePageContent(currentUrl.toString());
}

function updateActiveFilters() {
    const activeFilters = document.getElementById('activeFilters');
    const urlParams = new URLSearchParams(window.location.search);

    const searchTerm = urlParams.get('search') || '';
    const province = urlParams.get('province') || '';
    const municipal = urlParams.get('municipal') || '';
    const year = urlParams.get('year') || '';
    const dateFrom = urlParams.get('date_from') || '';
    const dateTo = urlParams.get('date_to') || '';

    let activeFiltersHTML = '';

    if (searchTerm) {
        activeFiltersHTML += `<div class="filter-tag">
            <i class="fas fa-search"></i> Search: "${searchTerm}"
            <button onclick="removeServerFilter('search')">×</button>
        </div>`;
    }

    if (province) {
        activeFiltersHTML += `<div class="filter-tag">
            <i class="fas fa-map-marker-alt"></i> Province: ${province}
            <button onclick="removeServerFilter('province')">×</button>
        </div>`;
    }

    if (municipal) {
        activeFiltersHTML += `<div class="filter-tag">
            <i class="fas fa-city"></i> Municipality: ${municipal}
            <button onclick="removeServerFilter('municipal')">×</button>
        </div>`;
    }

    if (year) {
        activeFiltersHTML += `<div class="filter-tag">
            <i class="fas fa-calendar"></i> Year: ${year}
            <button onclick="removeServerFilter('year')">×</button>
        </div>`;
    }

    if (dateFrom) {
        activeFiltersHTML += `<div class="filter-tag">
            <i class="fas fa-calendar-day"></i> From: ${dateFrom}
            <button onclick="removeServerFilter('date_from')">×</button>
        </div>`;
    }

    if (dateTo) {
        activeFiltersHTML += `<div class="filter-tag">
            <i class="fas fa-calendar-day"></i> To: ${dateTo}
            <button onclick="removeServerFilter('date_to')">×</button>
        </div>`;
    }

    activeFilters.innerHTML = activeFiltersHTML;
    if (activeFiltersHTML) {
        activeFilters.classList.remove('hidden');
    } else {
        activeFilters.classList.add('hidden');
    }
}

function removeServerFilter(filterName) {
    const currentUrl = new URL(window.location.href);
    currentUrl.searchParams.delete(filterName);
    currentUrl.searchParams.delete('page'); // Reset to first page

    // Clear the corresponding input field
    if (filterName === 'date_from') {
        document.getElementById('date_from').value = '';
    } else if (filterName === 'date_to') {
        document.getElementById('date_to').value = '';
    } else if (filterName === 'province') {
        document.getElementById('province').value = '';
    } else if (filterName === 'municipal') {
        document.getElementById('municipal').value = '';
    } else if (filterName === 'year') {
        document.getElementById('year').value = '';
    }

    // Smooth update instead of reload
    updatePageContent(currentUrl.toString());
}

// Quick filter
function applyQuickFilter(filterType) {
    // Remove active class from all buttons
    document.querySelectorAll('.quick-filter-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    
    // Add active class to clicked button
    event.target.closest('.quick-filter-btn').classList.add('active');
    
    // Build URL with filter parameter
    let url = new URL(window.location.href);
    url.search = ''; // Clear existing parameters
    
    switch(filterType) {
        case 'all':
            // No filter - show all
            break;
        case 'fatal':
            url.searchParams.set('fatal', 'true');
            break;
        case 'injury':
            url.searchParams.set('injury', 'true');
            break;
        case 'hotspot':
            url.searchParams.set('is_hotspot', 'true');
            break;
        case 'standalone':  // NEW CASE
            url.searchParams.set('no_hotspot', 'true');
            break;
    }
    
    // Redirect to filtered URL
    window.location.href = url.toString();
}

// Toggle advanced filters
function toggleAdvancedFilters() {
    const content = document.querySelector('.filters-content');
    const icon = document.querySelector('.filters-toggle i');
    
    content.classList.toggle('collapsed');
    icon.classList.toggle('fa-chevron-down');
    icon.classList.toggle('fa-chevron-up');
}

// Update municipalities based on selected province
function updateMunicipalityDropdown() {
    const provinceSelect = document.getElementById('province');
    const municipalitySelect = document.getElementById('municipal');
    const selectedProvince = provinceSelect.value;

    municipalitySelect.value = '';
    municipalitySelect.innerHTML = '<option value="">All Municipalities</option>';

    let municipalitiesToShow = selectedProvince ?
        (municipalityData[selectedProvince] || []) :
        [];

    municipalitiesToShow.forEach(function(mun) {
        const option = document.createElement('option');
        option.value = mun;
        option.textContent = mun;
        municipalitySelect.appendChild(option);
    });
}

// Export to CSV
function exportToCSV() {
    const searchParams = new URLSearchParams(window.location.search);
    searchParams.set('export', 'csv');
    window.location.href = '{% url "accident_list" %}?' + searchParams.toString();
}

// Navigate to accident
function viewAccident(id) {
    window.location.href = `/accidents/${id}/`;
}

function viewOnMap(lat, lng, accidentId) {
    if (accidentId) {
        window.location.href = `/map/?lat=${lat}&lng=${lng}&zoom=16&accident_id=${accidentId}&single=true&source=list`;
    } else {
        window.location.href = `/map/?lat=${lat}&lng=${lng}&zoom=15`;
    }
}

// Accident Modal Functions
let currentAccidentData = {};

function openAccidentModal(id, date, time, barangay, municipal, province, incidentType, isFatal, isInjury, isHotspot, lat, lng, street, victimCount, placeType, vehicle, station, clusterId) {
    currentAccidentData = { id, lat, lng };

    const modal = document.getElementById('accidentModal');

    // Populate modal content
    document.getElementById('modalDate').textContent = date;
    document.getElementById('modalTime').textContent = time;
    document.getElementById('modalLocation').textContent = `${barangay}, ${municipal}, ${province}`;
    document.getElementById('modalStreet').textContent = street || 'N/A';
    document.getElementById('modalIncidentType').textContent = incidentType;
    document.getElementById('modalVictims').textContent = `${victimCount} victim(s)`;
    document.getElementById('modalPlaceType').textContent = placeType || 'Road/Highway';
    document.getElementById('modalVehicle').textContent = vehicle || 'Not specified';
    document.getElementById('modalStation').textContent = station || 'Not specified';
    document.getElementById('modalCluster').textContent = clusterId || '-';

    // Add badges
    let badgesHTML = '';
    if (isFatal) {
        badgesHTML += '<span class="severity-badge fatal"><i class="fas fa-skull-crossbones"></i> Fatal</span>';
    } else if (isInjury) {
        badgesHTML += '<span class="severity-badge injury"><i class="fas fa-user-injured"></i> Injury</span>';
    } else {
        badgesHTML += '<span class="severity-badge property"><i class="fas fa-car"></i> Property</span>';
    }

    if (isHotspot) {
        badgesHTML += '<span class="hotspot-mini-badge"><i class="fas fa-fire"></i> Hotspot</span>';
    }

    document.getElementById('modalBadges').innerHTML = badgesHTML;

    // Set button actions - Updated to show only this accident on map
    document.getElementById('modalMapBtn').onclick = function() {
        window.location.href = `/map/?lat=${lat}&lng=${lng}&zoom=16&accident_id=${id}&single=true&source=list`;
    };

    document.getElementById('modalDetailBtn').onclick = function() {
        window.location.href = `/accidents/${id}/`;
    };

    // Show modal
    modal.classList.add('active');
    document.body.style.overflow = 'hidden';
}

function closeAccidentModal() {
    const modal = document.getElementById('accidentModal');
    modal.classList.remove('active');
    document.body.style.overflow = 'auto';
}

// Close modal on Escape key
document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
        closeAccidentModal();
    }
});

// Enter key for search
document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('searchInput');
    if (searchInput) {
        searchInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                performSearch();
            }
        });
    }
    
    // Initialize municipalities
    updateMunicipalities();
    
    // Province change handler
    const provinceSelect = document.getElementById('province');
    if (provinceSelect) {
        provinceSelect.addEventListener('change', updateMunicipalities);
    }
    
    // Set active quick filter based on URL
    const urlParams = new URLSearchParams(window.location.search);
    if (urlParams.get('fatal')) {
        document.querySelector('[onclick*="fatal"]')?.classList.add('active');
    } else if (urlParams.get('injury')) {
        document.querySelector('[onclick*="injury"]')?.classList.add('active');
    } else if (urlParams.get('is_hotspot')) {
        document.querySelector('[onclick*="hotspot"]')?.classList.add('active');
    }

    // Display active filters
    displayActiveFilters();
});

// Display active filters from URL parameters
function displayActiveFilters() {
    const urlParams = new URLSearchParams(window.location.search);
    const filterTagsContainer = document.getElementById('activeFiltersTags');

    let tagsHTML = '';
    let hasFilters = false;

    // Search filter
    const searchTerm = urlParams.get('search');
    if (searchTerm) {
        hasFilters = true;
        tagsHTML += `
            <div class="filter-tag">
                <i class="fas fa-search"></i> Search: "${searchTerm}"
                <button onclick="removeFilter('search')" title="Remove search">×</button>
            </div>
        `;
    }

    // Province filter
    const province = urlParams.get('province');
    if (province) {
        hasFilters = true;
        tagsHTML += `
            <div class="filter-tag">
                <i class="fas fa-map-marker-alt"></i> Province: ${province}
                <button onclick="removeFilter('province')" title="Remove province">×</button>
            </div>
        `;
    }

    // Municipal filter
    const municipal = urlParams.get('municipal');
    if (municipal) {
        hasFilters = true;
        tagsHTML += `
            <div class="filter-tag">
                <i class="fas fa-city"></i> Municipality: ${municipal}
                <button onclick="removeFilter('municipal')" title="Remove municipality">×</button>
            </div>
        `;
    }

    // Year filter
    const year = urlParams.get('year');
    if (year) {
        hasFilters = true;
        tagsHTML += `
            <div class="filter-tag">
                <i class="fas fa-calendar"></i> Year: ${year}
                <button onclick="removeFilter('year')" title="Remove year">×</button>
            </div>
        `;
    }

    // Fatal filter
    if (urlParams.get('fatal') === 'true') {
        hasFilters = true;
        tagsHTML += `
            <div class="filter-tag">
                <i class="fas fa-skull-crossbones"></i> Fatal Only
                <button onclick="removeFilter('fatal')" title="Remove fatal filter">×</button>
            </div>
        `;
    }

    // Injury filter
    if (urlParams.get('injury') === 'true') {
        hasFilters = true;
        tagsHTML += `
            <div class="filter-tag">
                <i class="fas fa-ambulance"></i> Injury Only
                <button onclick="removeFilter('injury')" title="Remove injury filter">×</button>
            </div>
        `;
    }

    // Hotspot filter
    if (urlParams.get('is_hotspot') === 'true') {
        hasFilters = true;
        tagsHTML += `
            <div class="filter-tag">
                <i class="fas fa-fire"></i> Hotspots Only
                <button onclick="removeFilter('is_hotspot')" title="Remove hotspot filter">×</button>
            </div>
        `;
    }

    // Standalone filter
    if (urlParams.get('is_hotspot') === 'false') {
        hasFilters = true;
        tagsHTML += `
            <div class="filter-tag">
                <i class="fas fa-map-marker-alt"></i> Standalone Only
                <button onclick="removeFilter('is_hotspot')" title="Remove standalone filter">×</button>
            </div>
        `;
    }

    // Show/hide filter section and update display
    if (hasFilters) {
        filterTagsContainer.innerHTML = tagsHTML;
        filterTagsContainer.classList.remove('hidden');
    } else {
        filterTagsContainer.innerHTML = '';
        filterTagsContainer.classList.add('hidden');
    }
}

// Filter changes are handled by inline onchange="applyServerSideFilters()"
// in the HTML elements for smooth AJAX updates
document.addEventListener('DOMContentLoaded', function() {

    // Display active filters on page load
    displayActiveFilters();
});

// Remove individual filter
function removeFilter(filterName) {
    const currentUrl = new URL(window.location.href);
    currentUrl.searchParams.delete(filterName);

    // Show loading
    document.querySelector('.loading-overlay').classList.add('active');

    // Redirect to URL without this filter
    window.location.href = currentUrl.toString();
}

// Clear all filters - Smooth update to base URL
function clearAllFilters() {
    updatePageContent(window.location.pathname);
}

// ===== SERVER-SIDE PAGINATION FUNCTIONS =====

function navigateToPage(pageNumber) {
    const currentUrl = new URL(window.location.href);
    currentUrl.searchParams.set('page', pageNumber);

    // Smooth update instead of reload
    updatePageContent(currentUrl.toString());
}

function changeItemsPerPage() {
    const perPage = document.getElementById('itemsPerPage').value;
    const currentUrl = new URL(window.location.href);

    // Update per_page parameter
    currentUrl.searchParams.set('per_page', perPage);
    // Reset to first page when changing items per page
    currentUrl.searchParams.delete('page');

    // Smooth update instead of reload
    updatePageContent(currentUrl.toString());
}

// Initialize on page load
document.addEventListener('DOMContentLoaded', function() {
    // Load filter values from URL parameters
    const urlParams = new URLSearchParams(window.location.search);

    const searchParam = urlParams.get('search') || '';
    const provinceParam = urlParams.get('province') || '';
    const municipalParam = urlParams.get('municipal') || '';
    const yearParam = urlParams.get('year') || '';
    const perPageParam = urlParams.get('per_page') || '100';

    // Set form values from URL
    if (searchParam) {
        document.getElementById('hotspotSearch').value = searchParam;
    }
    if (provinceParam) {
        document.getElementById('province').value = provinceParam;
    }
    if (municipalParam) {
        document.getElementById('municipal').value = municipalParam;
    }
    if (yearParam) {
        document.getElementById('year').value = yearParam;
    }

    // Set items per page dropdown from URL
    document.getElementById('itemsPerPage').value = perPageParam;

    // Update municipality dropdown based on selected province
    updateMunicipalityDropdown();

    // Restore municipal value after dropdown update
    if (municipalParam) {
        document.getElementById('municipal').value = municipalParam;
    }

    // Display active filter badges
    updateActiveFilters();

    // Scroll to search section when navigating pagination
    if (window.location.hash === '#search-section') {
        setTimeout(() => {
            const searchSection = document.getElementById('search-section');
            if (searchSection) {
                searchSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        }, 100);
    }
});
</script>
{% endblock %}

{% block content %}
<div class="accident-list-container">
    <!-- Loading Overlay -->
    <div class="loading-overlay">
        <div class="spinner"></div>
    </div>

    <!-- Hero Header -->
    <div class="page-hero">
        <div class="page-hero-content">
            <h1>
                <i class="fas fa-car-crash"></i>
                Accident Records
                <span class="hero-badge">{{ accidents.paginator.count }} Total</span>
            </h1>
            <p>Browse and analyze traffic accidents across Caraga Region</p>
        </div>
        <div class="hero-actions">
            <button class="btn btn-outline-light" onclick="exportToCSV()">
                <i class="fas fa-download"></i>
                Export CSV
            </button>
        </div>
    </div>

    <!-- View Toggle -->
    <div class="view-toggle">
        <button class="view-option active" onclick="switchView('cards')">📊 Cards View</button>
        <button class="view-option" onclick="switchView('table')">📋 Table View</button>
    </div>

    <!-- Summary Cards -->
    <div class="summary-cards">
        <div class="summary-card">
            <h3>{{ accidents.paginator.count }}</h3>
            <p>Total Accidents</p>
        </div>
        <div class="summary-card">
            <h3>{{ fatal_count|default:0 }}</h3>
            <p>Fatal</p>
        </div>
        <div class="summary-card">
            <h3>{{ injury_count|default:0 }}</h3>
            <p>Injuries</p>
        </div>
        <div class="summary-card">
            <h3>{{ hotspot_count|default:0 }}</h3>
            <p>Hotspots</p>
        </div>
    </div>

    <!-- Enhanced Filters Section -->
    <div class="filters-section" id="search-section">
        <div class="filters-header">
            <h3>Search & Filter Accidents</h3>
            <button type="button" class="btn btn-outline btn-sm" onclick="clearAllFilters()">
                Clear All
            </button>
        </div>

        <!-- Search Bar -->
        <div style="margin-bottom: 1.25rem;">
            <label style="display: block; font-weight: 500; color: #374151; font-size: 0.875rem; margin-bottom: 0.5rem;">
                Search Accidents
            </label>
            <div style="display: flex; gap: 0.5rem;">
                <div style="position: relative; flex: 1;">
                    <input type="text"
                           id="hotspotSearch"
                           placeholder="Search by location, severity, incident type, or barangay..."
                           onkeypress="if(event.key==='Enter') performSearch()">
                    <i class="fas fa-search search-icon"></i>
                </div>
                <button onclick="performSearch()" class="btn btn-primary" style="padding: 0.75rem 1.75rem; white-space: nowrap;">
                    🔍 Search
                </button>
            </div>

            <!-- Quick Search Buttons -->
            <div style="display: flex; gap: 0.5rem; flex-wrap: wrap; margin-top: 0.75rem;">
                <button onclick="quickSearch('Fatal')" class="quick-search-btn fatal">
                    <i class="fas fa-skull-crossbones"></i> Fatal
                </button>
                <button onclick="quickSearch('Injury')" class="quick-search-btn injury">
                    <i class="fas fa-user-injured"></i> Injury
                </button>
                <button onclick="quickSearch('Property Damage')" class="quick-search-btn property">
                    <i class="fas fa-car-crash"></i> Property Damage
                </button>
                <button onclick="quickSearch('Not Hotspot')" class="quick-search-btn standalone">
                    <i class="fas fa-circle-dot"></i> Standalone
                </button>
            </div>
        </div>

        <!-- Filter Grid -->
        <div class="filters-grid">
            <div class="filter-group">
                <label for="province">Province</label>
                <select name="province" id="province" onchange="updateMunicipalityDropdown(); applyServerSideFilters();">
                    <option value="">All Provinces</option>
                    {% for province in provinces %}
                        <option value="{{ province }}">{{ province }}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="filter-group">
                <label for="municipal">Municipality</label>
                <select name="municipal" id="municipal" onchange="applyServerSideFilters()">
                    <option value="">All Municipalities</option>
                </select>
            </div>

            <div class="filter-group">
                <label for="year">Year</label>
                <select name="year" id="year" onchange="applyServerSideFilters()">
                    <option value="">All Years</option>
                    {% for year in years %}
                        <option value="{{ year }}">{{ year }}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="filter-group">
                <label for="date_from">From Date</label>
                <input type="date" name="date_from" id="date_from" onchange="applyServerSideFilters()">
            </div>

            <div class="filter-group">
                <label for="date_to">To Date</label>
                <input type="date" name="date_to" id="date_to" onchange="applyServerSideFilters()">
            </div>
        </div>

        <!-- Active Filters Display -->
        <div class="active-filters" id="activeFilters">
            <!-- Active filters displayed dynamically -->
        </div>
    </div>

    <!-- Pagination Controls -->
    <div class="pagination-container">
        <div class="pagination-info">
            Showing {{ accidents.start_index }}-{{ accidents.end_index }} of {{ accidents.paginator.count }} accidents
        </div>
        <div class="pagination-controls">
            {% if accidents.has_previous %}
                <button onclick="navigateToPage('{{ accidents.previous_page_number }}')" class="btn btn-outline btn-sm">
                    ← Previous
                </button>
            {% else %}
                <button class="btn btn-outline btn-sm" disabled>← Previous</button>
            {% endif %}

            <span id="pageInfo">Page {{ accidents.number }} of {{ accidents.paginator.num_pages }}</span>

            {% if accidents.has_next %}
                <button onclick="navigateToPage('{{ accidents.next_page_number }}')" class="btn btn-outline btn-sm">
                    Next →
                </button>
            {% else %}
                <button class="btn btn-outline btn-sm" disabled>Next →</button>
            {% endif %}
        </div>
        <select id="itemsPerPage" onchange="changeItemsPerPage()">
            <option value="12">12 per page</option>
            <option value="24">24 per page</option>
            <option value="48">48 per page</option>
            <option value="100">100 per page</option>
            <option value="500">500 per page</option>
        </select>
    </div>

    <!-- Cards View -->
    <div id="cardsView">
        <div class="accidents-grid" id="accidentsContainer">
            {% for accident in accidents %}
            <div class="accident-card" onclick="openAccidentModal({{ accident.pk }}, '{{ accident.date_committed|date:"M d, Y" }}', '{{ accident.time_committed|time:"g:i A" }}', '{{ accident.barangay }}', '{{ accident.municipal }}', '{{ accident.province }}', '{{ accident.incident_type }}', {{ accident.victim_killed|yesno:"true,false" }}, {{ accident.victim_injured|yesno:"true,false" }}, {{ accident.is_hotspot|yesno:"true,false" }}, {{ accident.latitude }}, {{ accident.longitude }}, '{{ accident.street|default:"N/A" }}', {{ accident.victim_count|default:0 }}, '{{ accident.type_of_place|default:"Road/Highway" }}', '{{ accident.vehicle_kind|default:"Not specified" }}', '{{ accident.station|default:"Not specified" }}', '{{ accident.cluster_id|default:"-" }}')" style="cursor: pointer;">
                <div class="card-header">
                    <span class="severity-badge {% if accident.victim_killed %}fatal{% elif accident.victim_injured %}injury{% else %}property{% endif %}">
                        {% if accident.victim_killed %}
                            <i class="fas fa-skull-crossbones"></i> Fatal
                        {% elif accident.victim_injured %}
                            <i class="fas fa-user-injured"></i> Injury
                        {% else %}
                            <i class="fas fa-car"></i> Property
                        {% endif %}
                    </span>
                    {% if accident.is_hotspot %}
                    <span class="hotspot-mini-badge">
                        <i class="fas fa-fire"></i> Hotspot
                    </span>
                    {% endif %}
                </div>

                <div class="card-body">
                    <div class="card-date">
                        <i class="fas fa-calendar"></i>
                        <strong>{{ accident.date_committed|date:"M d, Y" }}</strong>
                        <span>•</span>
                        <i class="fas fa-clock"></i>
                        <span>{{ accident.time_committed|time:"g:i A" }}</span>
                    </div>

                    <div class="card-location">
                        <div class="card-location-title">{{ accident.barangay }}</div>
                        <div class="card-location-sub">
                            <i class="fas fa-map-marker-alt"></i>
                            {{ accident.municipal }}, {{ accident.province }}
                        </div>
                    </div>

                    <div class="card-type">
                        <i class="fas fa-info-circle"></i>
                        {{ accident.incident_type|truncatewords:5 }}
                    </div>

                    <div class="card-actions">
                        <button class="card-action-btn btn-view" onclick="event.stopPropagation(); viewAccident({{ accident.pk }})">
                            <i class="fas fa-eye"></i> View
                        </button>
                        <button class="card-action-btn btn-map" onclick="event.stopPropagation(); viewOnMap({{ accident.latitude }}, {{ accident.longitude }}, {{ accident.pk }})">
                            <i class="fas fa-map"></i> Map
                        </button>
                    </div>
                </div>
            </div>
            {% empty %}
            <div class="empty-state" style="grid-column: 1 / -1;">
                <i class="fas fa-search"></i>
                <h3>No accidents found</h3>
                <p>Try adjusting your filters or search criteria</p>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- Table View -->
    <div id="tableView" class="accidents-table-container" style="display: none;">
        <div id="tableResponsive" class="table-responsive scrollable">
            <table class="accidents-table">
                <thead>
                    <tr>
                        <th style="width: 5%;">Severity</th>
                        <th style="width: 15%;">Date & Time</th>
                        <th style="width: 25%;">Location</th>
                        <th style="width: 20%;">Incident Type</th>
                        <th style="width: 10%;" class="text-center">Casualties</th>
                        <th style="width: 10%;" class="text-center">Hotspot</th>
                        <th style="width: 15%;" class="text-center">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for accident in accidents %}
                    <tr onclick="viewAccident({{ accident.pk }})">
                        <td>
                            <span class="severity-dot {% if accident.victim_killed %}fatal{% elif accident.victim_injured %}injury{% else %}property{% endif %}"></span>
                        </td>
                        <td>
                            <div style="font-weight: 600;">{{ accident.date_committed|date:"M d, Y" }}</div>
                            <small style="color: #666;">{{ accident.time_committed|time:"g:i A" }}</small>
                        </td>
                        <td>
                            <div style="font-weight: 600; color: #333;">{{ accident.barangay }}</div>
                            <small style="color: #666;">{{ accident.municipal }}, {{ accident.province }}</small>
                        </td>
                        <td>
                            <span style="font-size: 0.9rem;">{{ accident.incident_type|truncatewords:4 }}</span>
                        </td>
                        <td class="text-center">
                            <span style="font-weight: 700; color: {% if accident.victim_killed %}var(--fatal-red){% elif accident.victim_injured %}var(--injury-orange){% else %}#6c757d{% endif %}">
                                {{ accident.victim_count|default:0 }}
                            </span>
                        </td>
                        <td class="text-center">
                            {% if accident.is_hotspot %}
                            <i class="fas fa-fire" style="color: var(--hotspot-red);"></i>
                            {% else %}
                            <span style="color: #ccc;">—</span>
                            {% endif %}
                        </td>
                        <td>
                            <div class="table-actions" onclick="event.stopPropagation()">
                                <button class="table-action-btn view" onclick="viewAccident({{ accident.pk }})">
                                    <i class="fas fa-eye"></i> View
                                </button>
                                <button class="table-action-btn map" onclick="viewOnMap({{ accident.latitude }}, {{ accident.longitude }})">
                                    <i class="fas fa-map"></i> Map
                                </button>
                            </div>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="7">
                            <div class="empty-state">
                                <i class="fas fa-search"></i>
                                <h3>No accidents found</h3>
                                <p>Try adjusting your filters or search criteria</p>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

</div>

<!-- Accident Details Modal -->
<div id="accidentModal" class="accident-modal">
    <div class="modal-overlay" onclick="closeAccidentModal()"></div>
    <div class="modal-content">
        <button class="modal-close" onclick="closeAccidentModal()">
            <i class="fas fa-times"></i>
        </button>

        <div class="modal-header">
            <h2 id="modalTitle">Accident Details</h2>
            <div id="modalBadges" class="modal-badges"></div>
        </div>

        <div class="modal-body">
            <div class="modal-info-grid">
                <div class="modal-info-item">
                    <i class="fas fa-calendar"></i>
                    <div>
                        <div class="modal-label">Date</div>
                        <div class="modal-value" id="modalDate"></div>
                    </div>
                </div>

                <div class="modal-info-item">
                    <i class="fas fa-clock"></i>
                    <div>
                        <div class="modal-label">Time</div>
                        <div class="modal-value" id="modalTime"></div>
                    </div>
                </div>

                <div class="modal-info-item">
                    <i class="fas fa-map-marker-alt"></i>
                    <div>
                        <div class="modal-label">Location</div>
                        <div class="modal-value" id="modalLocation"></div>
                    </div>
                </div>

                <div class="modal-info-item">
                    <i class="fas fa-road"></i>
                    <div>
                        <div class="modal-label">Street</div>
                        <div class="modal-value" id="modalStreet"></div>
                    </div>
                </div>

                <div class="modal-info-item">
                    <i class="fas fa-exclamation-triangle"></i>
                    <div>
                        <div class="modal-label">Incident Type</div>
                        <div class="modal-value" id="modalIncidentType"></div>
                    </div>
                </div>

                <div class="modal-info-item">
                    <i class="fas fa-users"></i>
                    <div>
                        <div class="modal-label">Victims</div>
                        <div class="modal-value" id="modalVictims"></div>
                    </div>
                </div>

                <div class="modal-info-item">
                    <i class="fas fa-building"></i>
                    <div>
                        <div class="modal-label">Place Type</div>
                        <div class="modal-value" id="modalPlaceType"></div>
                    </div>
                </div>

                <div class="modal-info-item">
                    <i class="fas fa-car"></i>
                    <div>
                        <div class="modal-label">Vehicle(s)</div>
                        <div class="modal-value" id="modalVehicle"></div>
                    </div>
                </div>

                <div class="modal-info-item">
                    <i class="fas fa-shield-alt"></i>
                    <div>
                        <div class="modal-label">Police Station</div>
                        <div class="modal-value" id="modalStation"></div>
                    </div>
                </div>

                <div class="modal-info-item">
                    <i class="fas fa-layer-group"></i>
                    <div>
                        <div class="modal-label">Cluster ID</div>
                        <div class="modal-value" id="modalCluster"></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal-footer">
            <button class="modal-btn btn-map" id="modalMapBtn">
                <i class="fas fa-map-marked-alt"></i> View on Map
            </button>
            <button class="modal-btn btn-detail" id="modalDetailBtn">
                <i class="fas fa-file-alt"></i> View Details
            </button>
        </div>
    </div>
</div>

{% endblock %}