{% extends 'admin_panel/base.html' %}

{% block title %}Create New User{% endblock %}

{% block content %}
<!-- Page Header -->
<div class="admin-page-header">
    <div>
        <h1 class="admin-page-title">
            <i class="fas fa-user-plus"></i>
            Create New User
        </h1>
        <div class="admin-breadcrumb">
            <a href="{% url 'admin_panel:dashboard' %}"><i class="fas fa-tachometer-alt"></i> Admin</a>
            <span>/</span>
            <a href="{% url 'admin_panel:users' %}">Users</a>
            <span>/</span>
            <span>Create</span>
        </div>
    </div>
    <a href="{% url 'admin_panel:users' %}" class="btn btn-outline">
        <i class="fas fa-arrow-left"></i>
        Back to Users
    </a>
</div>

<!-- Messages -->
{% if messages %}
    {% for message in messages %}
    <div class="alert alert-{{ message.tags }}">
        <i class="fas fa-info-circle"></i>
        {{ message }}
    </div>
    {% endfor %}
{% endif %}

<div style="max-width: 900px; margin: 0 auto;">
    <form method="post" onsubmit="return validateForm()">
        {% csrf_token %}

        <!-- Account Details -->
        <div class="admin-card">
            <div class="admin-card-header">
                <h2 class="admin-card-title">
                    <i class="fas fa-user"></i>
                    Account Details
                </h2>
            </div>

            <div class="form-group">
                <label class="form-label" for="username">Username <span style="color: var(--accent-red);">*</span></label>
                <input type="text" name="username" id="username" class="form-control" required>
                <small style="color: var(--text-light);">Must be unique. Letters, digits, and @/./+/-/_ only.</small>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                <div class="form-group">
                    <label class="form-label" for="password">Password <span style="color: var(--accent-red);">*</span></label>
                    <input type="password" name="password" id="password" class="form-control" required minlength="8">
                    <small style="color: var(--text-light);">At least 8 characters long.</small>
                </div>

                <div class="form-group">
                    <label class="form-label" for="confirm_password">Confirm Password <span style="color: var(--accent-red);">*</span></label>
                    <input type="password" name="confirm_password" id="confirm_password" class="form-control" required minlength="8">
                    <small style="color: var(--text-light);">Re-type the password.</small>
                </div>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                <div class="form-group">
                    <label class="form-label" for="first_name">First Name <span style="color: var(--accent-red);">*</span></label>
                    <input type="text" name="first_name" id="first_name" class="form-control" required>
                </div>

                <div class="form-group">
                    <label class="form-label" for="last_name">Last Name <span style="color: var(--accent-red);">*</span></label>
                    <input type="text" name="last_name" id="last_name" class="form-control" required>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label" for="email">Email Address</label>
                <input type="email" name="email" id="email" class="form-control">
            </div>
        </div>

        <!-- PNP Profile -->
        <div class="admin-card">
            <div class="admin-card-header">
                <h2 class="admin-card-title">
                    <i class="fas fa-shield-alt"></i>
                    PNP Profile
                </h2>
            </div>

            <div class="form-group">
                <label class="form-label" for="badge_number">Badge Number <span style="color: var(--accent-red);">*</span></label>
                <input type="text" name="badge_number" id="badge_number" class="form-control" required>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                <div class="form-group">
                    <label class="form-label" for="rank">Rank <span style="color: var(--accent-red);">*</span></label>
                    <select name="rank" id="rank" class="form-control" required>
                        {% for value, label in ranks %}
                        <option value="{{ value }}">{{ label }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label" for="role">Role <span style="color: var(--accent-red);">*</span></label>
                    <select name="role" id="role" class="form-control" required>
                        {% for value, label in roles %}
                        <option value="{{ value }}">{{ label }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                <div class="form-group">
                    <label class="form-label" for="region">Region <span style="color: var(--accent-red);">*</span></label>
                    <input type="text" name="region" id="region" class="form-control" value="Caraga" readonly style="background: #f5f5f5;">
                </div>

                <div class="form-group">
                    <label class="form-label" for="province">Province <span style="color: var(--accent-red);">*</span></label>
                    <select name="province" id="province" class="form-control" required onchange="updateStations()">
                        <option value="">-- Select Province --</option>
                        <option value="Agusan del Norte">Agusan del Norte</option>
                        <option value="Agusan del Sur">Agusan del Sur</option>
                        <option value="Surigao del Norte">Surigao del Norte</option>
                        <option value="Surigao del Sur">Surigao del Sur</option>
                        <option value="Dinagat Islands">Dinagat Islands</option>
                    </select>
                </div>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                <div class="form-group">
                    <label class="form-label" for="station">Station <span style="color: var(--accent-red);">*</span></label>
                    <select name="station" id="station" class="form-control" required>
                        <option value="">-- Select Province First --</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label" for="unit">Unit</label>
                    <input type="text" name="unit" id="unit" class="form-control" placeholder="e.g., Traffic Management Unit">
                </div>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                <div class="form-group">
                    <label class="form-label" for="mobile_number">Mobile Number</label>
                    <input type="text" name="mobile_number" id="mobile_number" class="form-control" placeholder="+639123456789">
                </div>

                <div class="form-group">
                    <label class="form-label" for="phone_number">Phone Number</label>
                    <input type="text" name="phone_number" id="phone_number" class="form-control" placeholder="(085) 123-4567">
                </div>
            </div>
        </div>

        <!-- Permissions -->
        <div class="admin-card">
            <div class="admin-card-header">
                <h2 class="admin-card-title">
                    <i class="fas fa-lock"></i>
                    Permissions
                </h2>
            </div>

            <div style="display: flex; flex-direction: column; gap: 1rem;">
                <label style="display: flex; align-items: center; gap: 0.75rem; cursor: pointer;">
                    <input type="checkbox" name="is_staff" style="width: 20px; height: 20px;">
                    <div>
                        <strong style="color: var(--text-dark);">Staff Status</strong>
                        <br>
                        <small style="color: var(--text-light);">User can access admin panel</small>
                    </div>
                </label>

                <label style="display: flex; align-items: center; gap: 0.75rem; cursor: pointer;">
                    <input type="checkbox" name="is_superuser" style="width: 20px; height: 20px;">
                    <div>
                        <strong style="color: var(--text-dark);">Superuser Status</strong>
                        <br>
                        <small style="color: var(--text-light);">Full system access - use with extreme caution!</small>
                    </div>
                </label>
            </div>
        </div>

        <!-- Submit Buttons -->
        <div style="display: flex; gap: 1rem; justify-content: flex-end;">
            <a href="{% url 'admin_panel:users' %}" class="btn btn-secondary">
                <i class="fas fa-times"></i>
                Cancel
            </a>
            <button type="submit" class="btn btn-success">
                <i class="fas fa-user-plus"></i>
                Create User
            </button>
        </div>
    </form>
</div>

{% endblock %}

{% block extra_js %}
<script>
// Caraga Region Police Stations Database
const stationsByProvince = {
    'Agusan del Norte': [
        'Butuan City Police Station',
        'Cabadbaran City Police Station',
        'Nasipit Municipal Police Station',
        'Buenavista Municipal Police Station',
        'Carmen Municipal Police Station',
        'Jabonga Municipal Police Station',
        'Kitcharao Municipal Police Station',
        'Las Nieves Municipal Police Station',
        'Magallanes Municipal Police Station',
        'Remedios T. Romualdez Municipal Police Station',
        'Santiago Municipal Police Station',
        'Tubay Municipal Police Station',
        'Provincial Police Office - Agusan del Norte'
    ],
    'Agusan del Sur': [
        'Bayugan City Police Station',
        'Prosperidad Municipal Police Station',
        'San Francisco Municipal Police Station',
        'Rosario Municipal Police Station',
        'Bunawan Municipal Police Station',
        'Trento Municipal Police Station',
        'Veruela Municipal Police Station',
        'La Paz Municipal Police Station',
        'Loreto Municipal Police Station',
        'Santa Josefa Municipal Police Station',
        'Talacogon Municipal Police Station',
        'Sibagat Municipal Police Station',
        'Esperanza Municipal Police Station',
        'Provincial Police Office - Agusan del Sur'
    ],
    'Surigao del Norte': [
        'Surigao City Police Station',
        'Alegria Municipal Police Station',
        'Bacuag Municipal Police Station',
        'Burgos Municipal Police Station',
        'Claver Municipal Police Station',
        'Dapa Municipal Police Station',
        'Del Carmen Municipal Police Station',
        'General Luna Municipal Police Station',
        'Gigaquit Municipal Police Station',
        'Mainit Municipal Police Station',
        'Malimono Municipal Police Station',
        'Pilar Municipal Police Station',
        'Placer Municipal Police Station',
        'San Benito Municipal Police Station',
        'San Francisco Municipal Police Station',
        'San Isidro Municipal Police Station',
        'Santa Monica Municipal Police Station',
        'Sison Municipal Police Station',
        'Socorro Municipal Police Station',
        'Surigao del Norte Provincial Police Station',
        'Tagana-an Municipal Police Station',
        'Tubod Municipal Police Station',
        'Provincial Police Office - Surigao del Norte'
    ],
    'Surigao del Sur': [
        'Tandag City Police Station',
        'Bislig City Police Station',
        'Barobo Municipal Police Station',
        'Bayabas Municipal Police Station',
        'Cagwait Municipal Police Station',
        'Cantilan Municipal Police Station',
        'Carmen Municipal Police Station',
        'Carrascal Municipal Police Station',
        'Cortes Municipal Police Station',
        'Hinatuan Municipal Police Station',
        'Lanuza Municipal Police Station',
        'Lianga Municipal Police Station',
        'Lingig Municipal Police Station',
        'Madrid Municipal Police Station',
        'Marihatag Municipal Police Station',
        'San Agustin Municipal Police Station',
        'San Miguel Municipal Police Station',
        'Tagbina Municipal Police Station',
        'Tago Municipal Police Station',
        'Provincial Police Office - Surigao del Sur'
    ],
    'Dinagat Islands': [
        'San Jose Municipal Police Station',
        'Basilisa Municipal Police Station',
        'Cagdianao Municipal Police Station',
        'Dinagat Municipal Police Station',
        'Libjo Municipal Police Station',
        'Loreto Municipal Police Station',
        'Tubajon Municipal Police Station',
        'Provincial Police Office - Dinagat Islands'
    ]
};

// Update stations dropdown based on selected province
function updateStations() {
    const provinceSelect = document.getElementById('province');
    const stationSelect = document.getElementById('station');
    const selectedProvince = provinceSelect.value;

    // Clear current options
    stationSelect.innerHTML = '<option value="">-- Select Station --</option>';

    if (selectedProvince && stationsByProvince[selectedProvince]) {
        // Add stations for selected province
        stationsByProvince[selectedProvince].forEach(station => {
            const option = document.createElement('option');
            option.value = station;
            option.textContent = station;
            stationSelect.appendChild(option);
        });
    } else {
        stationSelect.innerHTML = '<option value="">-- Select Province First --</option>';
    }
}

// Password validation
function validateForm() {
    const password = document.getElementById('password').value;
    const confirmPassword = document.getElementById('confirm_password').value;

    if (password !== confirmPassword) {
        alert('Passwords do not match! Please make sure both password fields are identical.');
        document.getElementById('confirm_password').focus();
        return false;
    }

    if (password.length < 8) {
        alert('Password must be at least 8 characters long!');
        document.getElementById('password').focus();
        return false;
    }

    return true;
}

// Visual feedback for password matching
document.addEventListener('DOMContentLoaded', function() {
    const password = document.getElementById('password');
    const confirmPassword = document.getElementById('confirm_password');

    function checkPasswordMatch() {
        if (confirmPassword.value === '') {
            confirmPassword.style.borderColor = '';
            return;
        }

        if (password.value === confirmPassword.value) {
            confirmPassword.style.borderColor = '#28a745';
            confirmPassword.style.borderWidth = '2px';
        } else {
            confirmPassword.style.borderColor = '#dc3545';
            confirmPassword.style.borderWidth = '2px';
        }
    }

    password.addEventListener('input', checkPasswordMatch);
    confirmPassword.addEventListener('input', checkPasswordMatch);
});
</script>
{% endblock %}
