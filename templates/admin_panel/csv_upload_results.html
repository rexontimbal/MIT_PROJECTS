{% extends 'admin_panel/base.html' %}

{% block title %}Import Results{% endblock %}

{% block content %}
<!-- Page Header -->
<div class="admin-page-header">
    <div>
        <h1 class="admin-page-title">
            <i class="fas fa-check-circle"></i>
            Import Results
        </h1>
        <div class="admin-breadcrumb">
            <a href="{% url 'admin_panel:dashboard' %}"><i class="fas fa-home"></i> Admin</a>
            <span>/</span>
            <a href="{% url 'admin_panel:csv_upload' %}">CSV Import</a>
            <span>/</span>
            <span>Results</span>
        </div>
    </div>
</div>

<!-- Success Message -->
{% if results.errors == 0 %}
<div style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; padding: 2rem; border-radius: 12px; margin-bottom: 2rem; box-shadow: 0 4px 6px rgba(16, 185, 129, 0.1);">
    <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
        <i class="fas fa-check-circle" style="font-size: 3rem;"></i>
        <div>
            <h2 style="margin: 0; font-size: 1.5rem;">Import Completed Successfully!</h2>
            <p style="margin: 0.5rem 0 0 0; opacity: 0.9;">All records imported without errors</p>
        </div>
    </div>
</div>
{% else %}
<div style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: white; padding: 2rem; border-radius: 12px; margin-bottom: 2rem; box-shadow: 0 4px 6px rgba(245, 158, 11, 0.1);">
    <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
        <i class="fas fa-exclamation-triangle" style="font-size: 3rem;"></i>
        <div>
            <h2 style="margin: 0; font-size: 1.5rem;">Import Completed with Warnings</h2>
            <p style="margin: 0.5rem 0 0 0; opacity: 0.9;">Some records encountered errors</p>
        </div>
    </div>
</div>
{% endif %}

<!-- Import Statistics -->
<div class="stats-grid" style="margin-bottom: 2rem;">
    <div class="stat-card green">
        <div class="stat-header">
            <span class="stat-title">Total Rows</span>
            <i class="fas fa-file-alt stat-icon"></i>
        </div>
        <div class="stat-value">{{ results.total_rows|default:0 }}</div>
        <div class="stat-label">In CSV file</div>
    </div>

    <div class="stat-card blue">
        <div class="stat-header">
            <span class="stat-title">Successfully Imported</span>
            <i class="fas fa-check-circle stat-icon"></i>
        </div>
        <div class="stat-value">{{ results.imported|default:0 }}</div>
        <div class="stat-label">Records added</div>
    </div>

    <div class="stat-card {% if results.errors > 0 %}orange{% else %}green{% endif %}">
        <div class="stat-header">
            <span class="stat-title">Errors</span>
            <i class="fas fa-exclamation-circle stat-icon"></i>
        </div>
        <div class="stat-value">{{ results.errors|default:0 }}</div>
        <div class="stat-label">Failed rows</div>
    </div>

    <div class="stat-card">
        <div class="stat-header">
            <span class="stat-title">Success Rate</span>
            <i class="fas fa-percent stat-icon"></i>
        </div>
        <div class="stat-value">
            {% widthratio results.imported results.total_rows 100 %}%
        </div>
        <div class="stat-label">Import efficiency</div>
    </div>
</div>

<!-- File Information -->
<div class="admin-card" style="margin-bottom: 2rem;">
    <div class="admin-card-header">
        <h2 class="admin-card-title">
            <i class="fas fa-info-circle"></i>
            Import Details
        </h2>
    </div>

    <div style="padding: 1.5rem;">
        <div style="display: grid; gap: 1rem;">
            <div style="display: flex; align-items: center; gap: 1rem; padding: 1rem; background: #f9fafb; border-radius: 8px;">
                <i class="fas fa-file-csv" style="font-size: 2rem; color: var(--primary);"></i>
                <div>
                    <div style="font-weight: 600; color: var(--text-dark); margin-bottom: 0.25rem;">File Name</div>
                    <div style="color: var(--text-light);">{{ results.filename }}</div>
                </div>
            </div>

            <div style="display: flex; align-items: center; gap: 1rem; padding: 1rem; background: #f9fafb; border-radius: 8px;">
                <i class="fas fa-database" style="font-size: 2rem; color: var(--success);"></i>
                <div>
                    <div style="font-weight: 600; color: var(--text-dark); margin-bottom: 0.25rem;">Records Imported</div>
                    <div style="color: var(--text-light);">{{ results.imported }} out of {{ results.total_rows }} total rows</div>
                </div>
            </div>

            {% if results.errors > 0 %}
            <div style="display: flex; align-items: center; gap: 1rem; padding: 1rem; background: #fef3c7; border-radius: 8px;">
                <i class="fas fa-exclamation-triangle" style="font-size: 2rem; color: var(--warning);"></i>
                <div>
                    <div style="font-weight: 600; color: var(--text-dark); margin-bottom: 0.25rem;">Errors Encountered</div>
                    <div style="color: var(--text-light);">{{ results.errors }} rows failed to import</div>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<!-- Error Details -->
{% if results.error_messages %}
<div class="admin-card" style="margin-bottom: 2rem;">
    <div class="admin-card-header">
        <h2 class="admin-card-title">
            <i class="fas fa-bug"></i>
            Error Log (First 10 Errors)
        </h2>
    </div>

    <div style="padding: 1.5rem;">
        <div style="background: #fef2f2; border-left: 4px solid #ef4444; padding: 1rem; border-radius: 4px;">
            {% for error in results.error_messages %}
            <div style="padding: 0.5rem 0; border-bottom: 1px solid #fecaca; font-family: monospace; font-size: 0.875rem; color: #991b1b;">
                {{ error }}
            </div>
            {% endfor %}
        </div>
    </div>
</div>
{% endif %}

<!-- Actions -->
<div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
    <a href="{% url 'admin_panel:csv_upload' %}" class="btn btn-primary">
        <i class="fas fa-upload"></i>
        Upload Another File
    </a>
    <a href="{% url 'admin_panel:data_view' %}" class="btn btn-outline">
        <i class="fas fa-database"></i>
        View Imported Data
    </a>
    <a href="{% url 'admin_panel:dashboard' %}" class="btn btn-outline">
        <i class="fas fa-home"></i>
        Back to Dashboard
    </a>
</div>
{% endblock %}
